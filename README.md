# Fix strongSwan rc.d script

strongSwan's current rc.d script has a few defects when using `vici`.  The proposed changes are an attempt to fix them.

On the [`ports` branch](https://github.com/jlduran/fix-strongswan-rc-script/tree/ports), the current `strongswan.in` rc script is tested.

On the [`patch` branch](https://github.com/jlduran/fix-strongswan-rc-script/tree/patch), the patched `strongswan.in` rc script is tested.

You can see the differences [here](https://github.com/jlduran/fix-strongswan-rc-script/compare/patch).

To try your own changes, simply drop-in a new `strongswan.in` file.

Here are the test results for both branches, invoking the service command while strongswan being either started or not (stopped).  There is also a test for respawning the service.

## `vici`

| Command     | Previous Service Status | Current rc script | Proposed rc script |
| -------     | ----------------------- | -----------------:| ------------------:|
| `start`     | stopped                 | [![start_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=start_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![start_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=start_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `start`     | started                 | [![start_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=start_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![start_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=start_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `stop`      | stopped                 | [![stop_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=stop_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![stop_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=stop_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `stop`      | started                 | [![stop_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=stop_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![stop_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=stop_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `restart`   | stopped                 | [![restart_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=restart_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![restart_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=restart_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `restart`   | started                 | [![restart_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=restart_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![restart_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=restart_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `status`    | stopped                 | [![status_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=status_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![status_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=status_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `status`    | started                 | [![status_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=status_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![status_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=status_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `statusall` | stopped                 | [![statusall_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=statusall_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![statusall_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=statusall_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `statusall` | started                 | [![statusall_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=statusall_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![statusall_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=statusall_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `reload`    | stopped                 | [![reload_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=reload_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![reload_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=reload_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `reload`    | started                 | [![reload_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=reload_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![reload_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=reload_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| N/A         | `SIGKILL`†              | [![SIGKILL](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=vici&script=sigkill)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![SIGKILL](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=vici&script=sigkill)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |

† **NOTE**: This implies that the daemon gets supervised _and restarted_.  While this was true for the old stroke, it is not true for vici as it is at the moment.

A user switching from stoke to vici would expect this behavior, as well as users switching from strongswan on Linux-based systems; charon-systemd supervises the process and respawns accordingly.

## `stroke`

The current failures in `stroke` are not critical, mostly non-standard—as in non-`rc.subr`-standard—error/exit codes and messages.

| Command     | Previous Service Status | Current rc script | Proposed rc script |
| -------     | ----------------------- | -----------------:| ------------------:|
| `start`     | stopped                 | [![start_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=start_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![start_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=start_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `start`     | started                 | [![start_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=start_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![start_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=start_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `stop`      | stopped                 | [![stop_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=stop_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![stop_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=stop_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `stop`      | started                 | [![stop_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=stop_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![stop_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=stop_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `restart`   | stopped                 | [![restart_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=restart_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![restart_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=restart_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `restart`   | started                 | [![restart_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=restart_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![restart_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=restart_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `status`    | stopped                 | [![status_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=status_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![status_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=status_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `status`    | started                 | [![status_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=status_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![status_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=status_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `statusall` | stopped                 | [![statusall_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=statusall_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![statusall_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=statusall_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `statusall` | started                 | [![statusall_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=statusall_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![statusall_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=statusall_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `reload`    | stopped                 | [![reload_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=reload_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![reload_stopped](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=reload_stopped)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| `reload`    | started                 | [![reload_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=reload_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![reload_started](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=reload_started)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
| N/A         | `SIGKILL`               | [![SIGKILL](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=ports&task=stroke&script=sigkill)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/ports) | [![SIGKILL](https://api.cirrus-ci.com/github/jlduran/fix-strongswan-rc-script.svg?branch=patch&task=stroke&script=sigkill)](https://cirrus-ci.com/github/jlduran/fix-strongswan-rc-script/patch) |
